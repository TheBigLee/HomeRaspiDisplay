<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Transport & Monitoring</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a1a;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            overflow: hidden;
        }

        .clock {
            position: fixed;
            top: 30px;
            right: 20px;
            background: rgba(42, 42, 42, 0.95);
            color: #e0e0e0;
            padding: 12px 20px;
            border-radius: 7px;
            font-size: 1.2rem;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            letter-spacing: 1.5px;
            z-index: 1000;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border: 1px solid #404040;
        }

        .clock .date {
            font-size: 0.8rem;
            font-weight: 400;
            color: #999;
            margin-top: 4px;
            text-align: center;
            letter-spacing: 0.8px;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: 80% 20%;
            grid-template-rows: 1fr 1fr;
            height: 100vh;
            gap: 0;
        }

        .panel {
            position: relative;
            overflow: hidden;
            border: 1px solid #2a2a2a;
        }

        .panel iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: block;
        }

        /* Transport panel takes left side (80%), full height */
        .transport-panel {
            grid-row: 1 / 3;
        }

        /* Grafana panels on the right (20%) */
        .grafana-panel-1 {
            grid-column: 2;
            grid-row: 1;
        }

        .grafana-panel-2 {
            grid-column: 2;
            grid-row: 2;
        }

        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }

            .transport-panel {
                grid-row: 1;
                height: 50vh;
            }

            .grafana-panel-1,
            .grafana-panel-2 {
                grid-column: 1;
                height: 25vh;
            }

            .grafana-panel-1 {
                grid-row: 2;
            }

            .grafana-panel-2 {
                grid-row: 3;
            }
        }
    </style>
</head>
<body>
    <!-- Current Time Display -->
    <div class="clock">
        <div id="time">--:--:--</div>
        <div class="date" id="date">-- --- ----</div>
    </div>

    <div class="dashboard-container">
        <!-- Transport Departures Panel -->
        <div class="panel transport-panel">
            <iframe src="index.html?kiosk&stations=${STATIONS}" title="Transport Departures"></iframe>
        </div>

        <!-- Grafana Panel 1 - Temperature -->
        <div class="panel grafana-panel-1">
            <iframe src="${GRAFANA_URL_1}" title="Temperature Dashboard"></iframe>
        </div>

        <!-- Grafana Panel 2 - Second temperature panel -->
        <div class="panel grafana-panel-2">
            <iframe src="${GRAFANA_URL_2}" title="Temperature Dashboard 2"></iframe>
        </div>
    </div>

    <script>
        // Parse URL parameters and update iframe src if stations parameter is provided
        function initializeDashboard() {
            const urlParams = new URLSearchParams(window.location.search);
            const stationsParam = urlParams.get('stations') || urlParams.get('s');

            if (stationsParam) {
                // Update the transport panel iframe src with the stations parameter
                const transportIframe = document.querySelector('.transport-panel iframe');
                const currentSrc = transportIframe.getAttribute('src');
                const baseUrl = currentSrc.split('?')[0];
                transportIframe.setAttribute('src', `${baseUrl}?kiosk&stations=${encodeURIComponent(stationsParam)}`);
            }
        }

        function updateClock() {
            const now = new Date();

            // Format time (HH:MM:SS)
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            const timeString = `${hours}:${minutes}:${seconds}`;

            // Format date (DD MMM YYYY)
            const options = { day: '2-digit', month: 'short', year: 'numeric' };
            const dateString = now.toLocaleDateString('en-GB', options);

            // Update DOM
            document.getElementById('time').textContent = timeString;
            document.getElementById('date').textContent = dateString;
        }

        // Initialize dashboard with URL parameters
        initializeDashboard();

        // Update clock immediately and then every second
        updateClock();
        setInterval(updateClock, 1000);
    </script>
</body>
</html>
